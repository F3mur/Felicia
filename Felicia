import discord
from discord.ext import commands
import asyncio
import random
from datetime import timedelta

# เปิดใช้งาน Intents
intents = discord.Intents.default()
intents.message_content = True

# ตั้งค่าบอท
bot = commands.Bot(command_prefix='!', intents=intents)

# กำหนดคำที่ไม่เหมาะสม
BAD_WORDS = ["ควย", "หี", "เย็ด", "กระหรี่", "งานกาก", "รูปกาก", "ลูกอีหน่อแตด", "https://discord.com", "https://discord.gg", "nigga", "nigger", "Nigga", "NIGGA", "NIGGERS"]

# ใช้ set เพื่อเก็บข้อความที่เคยได้รับการจัดการแล้ว
processed_messages = set()

@bot.event
async def on_ready():
    print(f'บอทออนไลน์แล้วค่ะ! ชื่อ: {bot.user.name} (ID: {bot.user.id})')

@bot.event
async def on_message(message):
    # ป้องกันการทำงานซ้ำหากข้อความถูกจัดการแล้ว
    if message.author == bot.user or message.id in processed_messages:
        return

    # ตรวจสอบว่าในข้อความมีคำไม่เหมาะสมหรือไม่
    if any(bad_word in message.content.lower() for bad_word in BAD_WORDS):
        messages_to_delete = [message]

        # การส่งข้อความ reply พร้อม mention
        reply_message = await message.reply(f"คุณลูกค้า {message.author.mention} พูดจาแบบนี้ต้องโดนกักบริเวณนะคะ", mention_author=True)
        messages_to_delete.append(reply_message)
        await asyncio.sleep(1)

        # นับถอยหลังเป็น 0.3 วินาที
        countdown_messages = ["3", "2", "1", "ตู้ม✨️"]
        for text in countdown_messages:
            countdown_message = await message.channel.send(text)
            messages_to_delete.append(countdown_message)
            await asyncio.sleep(0.3)  # หน่วงเวลา 0.3 วินาทีระหว่างแต่ละข้อความ

        # ลบข้อความทั้งหมด
        for msg in messages_to_delete:
            await msg.delete()

        # เพิ่มข้อความที่ได้รับการจัดการลงใน set
        processed_messages.add(message.id)

        try:
            timeout_duration = timedelta(minutes=1)
            await message.author.timeout(timeout_duration, reason="ใช้คำไม่เหมาะสม")

            # สุ่มข้อความแจ้งเตือนตามเปอร์เซ็นต์ที่กำหนด
            random_number = random.randint(1, 100)

            if random_number <= 70:  
                notify_message = await message.channel.send(f"คุณลูกค้า {message.author.mention} โดนกักบริเวณ 1 นาทีเพราะทำตัวไม่น่ารัก!")
            elif random_number <= 90:  
                notify_message = await message.channel.send(f"{message.author.mention} เด็กดื้อต้องโดนอะไรน้าาา")
            elif random_number <= 99:  
                notify_message = await message.channel.send(f"ไอ้ลูกค้า {message.author.mention} โดนกักบริเวณ 1 นาที")
            else:  
                notify_message = await message.channel.send(f"ไอสวะ {message.author.mention} โดน timeout")

            # รอ 3 วินาทีก่อนลบข้อความ
            await asyncio.sleep(3)
            await notify_message.delete()

        except Exception as e:
            print(f"ไม่สามารถ Timeout สมาชิกได้: {e}")

bot.run('MTI4NjI2NTQxODM1MjE2OTAyMg.Gwz8Bo.eUxtpFg0H0Bzgu6hLj2uZrALLzpxUui8c0DHFo')
